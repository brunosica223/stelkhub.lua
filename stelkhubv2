--[[
    STELK HUB - ANIME VORTEX Z
    VersÃ£o: 15.0 - ULTIMATE (3.0)
    ============================================
    Esta Ã© a versÃ£o mais completa e robusta do Stelk Hub.
    Foram implementadas mÃºltiplas estratÃ©gias para garantir
    o funcionamento em qualquer cenÃ¡rio, com fallbacks e
    sistemas de debug avanÃ§ados.
    
    CARACTERÃSTICAS:
    - GUI 300x300 com bordas arredondadas e design elegante
    - DetecÃ§Ã£o de mundo por nome, coordenadas e cores
    - Sistema de stars com 6 mÃ©todos de interaÃ§Ã£o diferentes
    - Sistema de units com busca recursiva em todas as pastas
    - Sistema de mobs com seleÃ§Ã£o e indicaÃ§Ã£o de boss
    - Farm automÃ¡tico com movimento por WalkSpeed e ataques
    - Bypass multi-camadas com spoof, desconexÃ£o e bloqueio
    - Logs detalhados para debug
    - Totalmente configurÃ¡vel via variÃ¡veis no inÃ­cio
    
    AUTOR: Stelk
    DATA: Fevereiro 2026
    ============================================
]]

-- ================ CONFIGURAÃ‡Ã•ES INICIAIS ================
-- Altere estas variÃ¡veis conforme necessÃ¡rio para seu jogo

local CONFIG = {
    -- Tamanho da GUI
    GUI_WIDTH = 300,
    GUI_HEIGHT = 300,
    
    -- Velocidade do movimento no farm
    FARM_SPEED = 120,
    
    -- Tempo de espera apÃ³s morte do mob (respawn)
    RESPAWN_WAIT = 5,
    
    -- DistÃ¢ncia mÃ­nima para considerar que chegou ao mob
    MOVE_DISTANCE_TOLERANCE = 5,
    
    -- Palavras-chave para detecÃ§Ã£o de mundo
    WORLD_KEYWORDS = {
        leaf = {"leaf", "village", "konoha", "naruto", "hokage", "folha"},
        fire = {"fire", "fogo", "flame", "inferno"},
        water = {"water", "agua", "ocean", "mar", "lake"},
        wind = {"wind", "vento", "storm", "tempestade"},
        mountain = {"mountain", "montanha", "rock", "pedra"},
        forest = {"forest", "floresta", "woods", "selva"}
    },
    
    -- Nomes exatos para stars (adicione quantos precisar)
    STAR_NAMES = {"Star", "Gacha", "Spin", "Wheel", "Roda", "Crystal"},
    
    -- Pastas onde procurar units
    UNIT_FOLDERS = {"Units", "Pets", "Characters", "Inventory", "Bag", "Storage", "Deployed", "MyUnits", "Team", "Party"},
    
    -- Propriedades de dano para units
    DAMAGE_PROPS = {"Damage", "Power", "Atk", "Attack", "Dano", "Strength", "Force"},
    
    -- Remotes para equipar units
    EQUIP_REMOTES = {"EquipUnit", "SelectUnit", "UseUnit", "Equip", "Select"},
    
    -- Remotes de ataque para units
    ATTACK_REMOTES = {"Attack", "Skill", "Combat", "Use", "Cast", "Ability"},
    
    -- Palavras-chave para identificar bosses
    BOSS_KEYWORDS = {"boss", "chefe", "lider", "elite", "mini-boss"},
    
    -- HP mÃ­nimo para considerar boss
    BOSS_HP_THRESHOLD = 50000,
    
    -- Coordenadas aproximadas para mundos (caso nÃ£o detecte por nome)
    WORLD_COORDINATES = {
        leaf = {minX = 500, maxX = 2000, minZ = -1000, maxZ = 1000},
        fire = {minX = -2000, maxX = -500, minZ = -1000, maxZ = 1000}
    }
}

-- ================ SERVIÃ‡OS ================
local player = game.Players.LocalPlayer
local runService = game:GetService("RunService")
local tweenService = game:GetService("TweenService")
local userInputService = game:GetService("UserInputService")
local replicatedStorage = game:GetService("ReplicatedStorage")
local coreGui = game:GetService("CoreGui")
local players = game:GetService("Players")
local workspace = game:GetService("Workspace")

-- ================ VARIÃVEIS GLOBAIS ================
local bypassActive = false
local farmActive = false
local selectedMob = nil
local selectedUnit = nil
local currentWorld = "Desconhecido"
local currentWorldColor = Color3.fromRGB(150,150,150)
local inLeafWorld = false
local gems = 0
local gold = 0
local selectedStar = nil
local stars = {}
local mobs = {}
local units = {}
local hubVisible = true
local farmConnection = nil
local worldsDetected = {}
local debugMode = true  -- Ative para ver logs no console

-- ================ CORES ================
local colors = {
    background = Color3.fromRGB(18, 18, 18),
    secondary = Color3.fromRGB(30, 30, 30),
    tertiary = Color3.fromRGB(45, 45, 45),
    accent = Color3.fromRGB(255, 255, 255),
    success = Color3.fromRGB(100, 200, 100),
    danger = Color3.fromRGB(255, 80, 80),
    text = Color3.fromRGB(255, 255, 255),
    textDim = Color3.fromRGB(180, 180, 180),
    selected = Color3.fromRGB(80, 150, 255),
    warning = Color3.fromRGB(255, 200, 100),
    world1 = Color3.fromRGB(100, 200, 100),  -- Verde
    world2 = Color3.fromRGB(200, 100, 100),  -- Vermelho
    world3 = Color3.fromRGB(100, 100, 200),  -- Azul
    world4 = Color3.fromRGB(200, 200, 100),  -- Amarelo
    world5 = Color3.fromRGB(200, 100, 200),  -- Roxo
    world6 = Color3.fromRGB(100, 200, 200)   -- Ciano
}

-- ================ FUNÃ‡Ã•ES DE DEBUG ================
local function log(msg, type)
    if not debugMode then return end
    local prefix = ""
    if type == "error" then prefix = "âŒ "
    elseif type == "success" then prefix = "âœ… "
    elseif type == "warning" then prefix = "âš ï¸ "
    elseif type == "info" then prefix = "â„¹ï¸ "
    else prefix = "ðŸ”¹ " end
    print(prefix .. msg)
end

-- ================ DETECÃ‡ÃƒO DE MUNDO (MÃšLTIPLOS MÃ‰TODOS) ================
local function detectCurrentWorld()
    log("Detectando mundo atual...", "info")
    
    -- MÃ©todo 1: Por nomes de objetos
    local worldNames = {
        {name = "ðŸƒ Leaf World", keywords = CONFIG.WORLD_KEYWORDS.leaf, color = colors.world1},
        {name = "ðŸ”¥ Fire World", keywords = CONFIG.WORLD_KEYWORDS.fire, color = colors.world2},
        {name = "ðŸ’§ Water World", keywords = CONFIG.WORLD_KEYWORDS.water, color = colors.world3},
        {name = "ðŸŒªï¸ Wind World", keywords = CONFIG.WORLD_KEYWORDS.wind, color = colors.world4},
        {name = "â›°ï¸ Mountain World", keywords = CONFIG.WORLD_KEYWORDS.mountain, color = colors.world5},
        {name = "ðŸŒ² Forest World", keywords = CONFIG.WORLD_KEYWORDS.forest, color = colors.world6}
    }
    
    for _, world in ipairs(worldNames) do
        for _, obj in ipairs(workspace:GetDescendants()) do
            local name = obj.Name:lower()
            for _, kw in ipairs(world.keywords) do
                if name:find(kw) then
                    currentWorld = world.name
                    currentWorldColor = world.color
                    inLeafWorld = (world.name == "ðŸƒ Leaf World")
                    log("Mundo detectado por nome: " .. currentWorld, "success")
                    return
                end
            end
        end
    end
    
    -- MÃ©todo 2: Por coordenadas
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local pos = player.Character.HumanoidRootPart.Position
        for worldName, coords in pairs(CONFIG.WORLD_COORDINATES) do
            if pos.X >= coords.minX and pos.X <= coords.maxX and pos.Z >= coords.minZ and pos.Z <= coords.maxZ then
                if worldName == "leaf" then
                    currentWorld = "ðŸƒ Leaf World"
                    currentWorldColor = colors.world1
                    inLeafWorld = true
                elseif worldName == "fire" then
                    currentWorld = "ðŸ”¥ Fire World"
                    currentWorldColor = colors.world2
                    inLeafWorld = false
                end
                log("Mundo detectado por coordenadas: " .. currentWorld, "success")
                return
            end
        end
    end
    
    -- MÃ©todo 3: Por cores de terreno (se houver)
    -- (implementaÃ§Ã£o genÃ©rica, pode ser adaptada)
    
    currentWorld = "â“ Mundo Desconhecido"
    currentWorldColor = colors.textDim
    inLeafWorld = false
    log("Mundo nÃ£o detectado", "warning")
end

-- ================ DETECÃ‡ÃƒO DE GEMS E GOLD ================
local function getGemsAndGold()
    gems = 0
    gold = 0
    
    -- Procura em leaderstats
    if player:FindFirstChild("leaderstats") then
        for _, child in ipairs(player.leaderstats:GetChildren()) do
            local name = child.Name:lower()
            if name:find("gem") then gems = child.Value or 0 end
            if name:find("gold") or name:find("coin") then gold = child.Value or 0 end
        end
    end
    
    -- Procura em valores numÃ©ricos do jogador
    for _, obj in ipairs(player:GetChildren()) do
        if obj:IsA("NumberValue") then
            local name = obj.Name:lower()
            if name:find("gem") then gems = obj.Value end
            if name:find("gold") then gold = obj.Value end
        end
    end
    
    log("Gems: " .. gems .. ", Gold: " .. gold, "info")
    return gems, gold
end

-- ================ SISTEMA DE STARS (MÃšLTIPLOS MÃ‰TODOS) ================
local function findStars()
    local found = {}
    log("Procurando Stars...", "info")
    
    -- MÃ©todo 1: Nomes exatos
    for _, obj in ipairs(workspace:GetDescendants()) do
        for _, starName in ipairs(CONFIG.STAR_NAMES) do
            if obj.Name == starName then
                if obj:IsA("BasePart") or obj:IsA("Model") then
                    table.insert(found, obj)
                    log("Star encontrada (nome exato): " .. obj.Name, "success")
                    break
                end
            end
        end
    end
    
    -- MÃ©todo 2: Partes com nome contendo "star"
    if #found < 6 then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj.Name:lower():find("star") and (obj:IsA("BasePart") or obj:IsA("Model")) then
                if not table.find(found, obj) then
                    table.insert(found, obj)
                    log("Star encontrada (contÃ©m star): " .. obj.Name, "success")
                end
            end
        end
    end
    
    -- MÃ©todo 3: ClickDetectors
    if #found < 6 then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("ClickDetector") and obj.Parent then
                for _, starName in ipairs(CONFIG.STAR_NAMES) do
                    if obj.Parent.Name == starName or obj.Parent.Name:lower():find("star") then
                        if not table.find(found, obj.Parent) then
                            table.insert(found, obj.Parent)
                            log("Star encontrada via ClickDetector: " .. obj.Parent.Name, "success")
                        end
                        break
                    end
                end
            end
        end
    end
    
    -- MÃ©todo 4: ProximityPrompts
    if #found < 6 then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("ProximityPrompt") and obj.Parent then
                for _, starName in ipairs(CONFIG.STAR_NAMES) do
                    if obj.Parent.Name == starName or obj.Parent.Name:lower():find("star") then
                        if not table.find(found, obj.Parent) then
                            table.insert(found, obj.Parent)
                            log("Star encontrada via ProximityPrompt: " .. obj.Parent.Name, "success")
                        end
                        break
                    end
                end
            end
        end
    end
    
    log("Total de Stars: " .. #found, "info")
    return found
end

local function spinStar(star)
    if not star then return false end
    log("Tentando girar: " .. star.Name, "info")
    
    -- MÃ©todo 1: ClickDetector
    local detector = star:FindFirstChildOfClass("ClickDetector")
    if detector then
        fireclickdetector(detector)
        log("Girou via ClickDetector", "success")
        return true
    end
    
    -- MÃ©todo 2: ProximityPrompt
    local prompt = star:FindFirstChildOfClass("ProximityPrompt")
    if prompt then
        prompt:InputHoldBegin()
        task.wait(0.1)
        prompt:InputHoldEnd()
        log("Girou via ProximityPrompt", "success")
        return true
    end
    
    -- MÃ©todo 3: TouchInterest
    local touch = star:FindFirstChildOfClass("TouchTransmitter")
    if touch and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        firetouchinterest(player.Character.HumanoidRootPart, star, 0)
        task.wait(0.1)
        firetouchinterest(player.Character.HumanoidRootPart, star, 1)
        log("Girou via TouchInterest", "success")
        return true
    end
    
    -- MÃ©todo 4: RemoteEvent
    for _, child in ipairs(star:GetChildren()) do
        if child:IsA("RemoteEvent") then
            child:FireServer()
            log("Girou via RemoteEvent: " .. child.Name, "success")
            return true
        end
    end
    
    -- MÃ©todo 5: Simular toque (se for uma BasePart)
    if star:IsA("BasePart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local oldPos = player.Character.HumanoidRootPart.Position
        player.Character.HumanoidRootPart.CFrame = star.CFrame + Vector3.new(0, 5, 0)
        task.wait(0.2)
        player.Character.HumanoidRootPart.CFrame = CFrame.new(oldPos)
        log("Girou por aproximaÃ§Ã£o", "success")
        return true
    end
    
    log("Falha ao girar " .. star.Name, "error")
    return false
end

-- ================ SISTEMA DE MOBS ================
local function findMobs()
    local found = {}
    log("Procurando mobs...", "info")
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") then
            local humanoid = obj:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 and obj ~= player.Character then
                -- Verifica se Ã© boss
                local isBoss = false
                if humanoid.MaxHealth > CONFIG.BOSS_HP_THRESHOLD then
                    isBoss = true
                end
                local name = obj.Name:lower()
                for _, kw in ipairs(CONFIG.BOSS_KEYWORDS) do
                    if name:find(kw) then
                        isBoss = true
                        break
                    end
                end
                
                table.insert(found, {
                    Object = obj,
                    Name = obj.Name,
                    Health = humanoid.Health,
                    MaxHealth = humanoid.MaxHealth,
                    IsBoss = isBoss
                })
            end
        end
    end
    
    log("Total de mobs: " .. #found, "info")
    return found
end

-- ================ SISTEMA DE UNITS (BUSCA RECURSIVA) ================
local function findUnits()
    local found = {}
    log("Procurando units no inventÃ¡rio...", "info")
    
    -- FunÃ§Ã£o para extrair dano de um objeto
    local function getDamage(obj)
        for _, prop in ipairs(CONFIG.DAMAGE_PROPS) do
            local val = obj:FindFirstChild(prop)
            if val and val:IsA("NumberValue") then
                return val.Value
            end
        end
        return 0
    end
    
    -- FunÃ§Ã£o recursiva para buscar em pastas
    local function searchIn(container, depth)
        if depth > 5 then return end  -- Evita loops infinitos
        if not container then return end
        
        for _, child in ipairs(container:GetChildren()) do
            if child:IsA("Model") or child:IsA("Folder") then
                local damage = getDamage(child)
                local hasHumanoid = child:FindFirstChildOfClass("Humanoid") ~= nil
                
                -- Considera como unit se tiver dano, humanoid, ou nome sugestivo
                if damage > 0 or hasHumanoid or child.Name:lower():find("unit") or child.Name:lower():find("pet") then
                    table.insert(found, {
                        Name = child.Name,
                        Damage = damage,
                        Object = child,
                        HasHumanoid = hasHumanoid
                    })
                    log("Unit encontrada: " .. child.Name .. " (Dano: " .. damage .. ")", "success")
                end
                
                -- Continua a busca dentro
                searchIn(child, depth + 1)
            end
        end
    end
    
    -- Pastas principais
    local roots = {
        player,
        player:FindFirstChild("PlayerGui"),
        player:FindFirstChild("Backpack"),
        player:FindFirstChild("StarterGear"),
        replicatedStorage
    }
    
    -- Pastas especÃ­ficas configuradas
    for _, folderName in ipairs(CONFIG.UNIT_FOLDERS) do
        local folder = player:FindFirstChild(folderName)
        if folder then
            table.insert(roots, folder)
        end
    end
    
    for _, root in ipairs(roots) do
        if root then
            searchIn(root, 0)
        end
    end
    
    -- Remove duplicatas (pelo objeto)
    local unique = {}
    local seen = {}
    for _, unit in ipairs(found) do
        if not seen[unit.Object] then
            seen[unit.Object] = true
            table.insert(unique, unit)
        end
    end
    
    -- Ordena por dano
    table.sort(unique, function(a, b) return a.Damage > b.Damage end)
    
    log("Total de units Ãºnicas: " .. #unique, "info")
    return unique
end

-- ================ COMANDOS PARA UNITS ATACAREM ================
local function commandUnitsToAttack(target)
    if not target then return end
    log("Comandando units para atacar: " .. target.Name, "info")
    
    for _, unit in ipairs(units) do
        if unit.Object and unit.Object.Parent then
            -- MÃ©todo 1: RemoteEvent de ataque
            for _, remoteName in ipairs(CONFIG.ATTACK_REMOTES) do
                local attackRemote = unit.Object:FindFirstChild(remoteName)
                if attackRemote and attackRemote:IsA("RemoteEvent") then
                    attackRemote:FireServer(target)
                    log("Unit " .. unit.Name .. " atacou via " .. remoteName, "success")
                    break
                end
            end
            
            -- MÃ©todo 2: Colocar target no Humanoid
            if unit.HasHumanoid then
                local humanoid = unit.Object:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    local targetValue = unit.Object:FindFirstChild("Target")
                    if targetValue and targetValue:IsA("ObjectValue") then
                        targetValue.Value = target
                    end
                    -- ForÃ§a o humanoid a caminhar em direÃ§Ã£o ao alvo
                    if target:FindFirstChild("HumanoidRootPart") then
                        humanoid:MoveTo(target.HumanoidRootPart.Position)
                    end
                end
            end
        end
    end
end

-- ================ MOVIMENTO SEGURO ATÃ‰ O MOB ================
local function moveToMob(mob)
    if not mob then return end
    local root = mob:FindFirstChild("HumanoidRootPart") or mob:FindFirstChild("Torso") or mob:FindFirstChild("UpperTorso")
    if not root then return end
    
    local char = player.Character
    if not char then return end
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    local charRoot = char:FindFirstChild("HumanoidRootPart")
    if not humanoid or not charRoot then return end
    
    local targetPos = root.Position + Vector3.new(0, 5, 0)
    local distance = (targetPos - charRoot.Position).Magnitude
    if distance < CONFIG.MOVE_DISTANCE_TOLERANCE then return end
    
    log("Movendo atÃ© mob. DistÃ¢ncia: " .. distance, "info")
    
    local originalSpeed = humanoid.WalkSpeed
    humanoid.WalkSpeed = CONFIG.FARM_SPEED
    humanoid:MoveTo(targetPos)
    
    local timeout = tick() + 5 + distance / 60
    while (charRoot.Position - targetPos).Magnitude > CONFIG.MOVE_DISTANCE_TOLERANCE and tick() < timeout do
        humanoid:MoveTo(targetPos)
        task.wait(0.1)
    end
    
    humanoid.WalkSpeed = originalSpeed
    log("Movimento concluÃ­do", "success")
end

-- ================ FARM AUTOMÃTICO ================
local function startFarming()
    if not selectedMob then
        log("Nenhum mob selecionado", "error")
        return
    end
    
    farmActive = true
        log("Farm iniciado para: " .. selectedMob.Name, "success")
    
    farmConnection = task.spawn(function()
        while farmActive do
            -- Atualiza lista de mobs
            mobs = findMobs()
            
            -- Procura o mob selecionado atual
            local currentMob = nil
            for _, mob in ipairs(mobs) do
                if mob.Name == selectedMob.Name then
                    currentMob = mob
                    break
                end
            end
            
            if not currentMob then
                log("Mob morto, aguardando respawn...", "info")
                task.wait(CONFIG.RESPAWN_WAIT)
            else
                -- Atualiza units
                units = findUnits()
                
                if currentMob.IsBoss then
                    log("Boss detectado - atacando de longe", "warning")
                    commandUnitsToAttack(currentMob.Object)
                    task.wait(2)
                else
                    moveToMob(currentMob.Object)
                    commandUnitsToAttack(currentMob.Object)
                    
                    -- Verifica se o mob morreu
                    local humanoid = currentMob.Object:FindFirstChildOfClass("Humanoid")
                    if humanoid and humanoid.Health <= 0 then
                        log("Mob morto!", "success")
                    end
                end
            end
            task.wait(1)
        end
    end)
end

local function stopFarming()
    farmActive = false
    if farmConnection then
        farmConnection = nil
    end
    log("Farm parado", "info")
end

-- ================ EQUIPAR MELHOR UNIT ================
local function equipBestUnit()
    units = findUnits()
    if #units == 0 then
        log("Nenhuma unit encontrada para equipar", "error")
        return
    end
    
    local best = units[1]
    log("Melhor unit: " .. best.Name .. " (Dano: " .. best.Damage .. ")", "success")
    
    if best.Object then
        -- Tenta remote de equipar
        for _, remoteName in ipairs(CONFIG.EQUIP_REMOTES) do
            local remote = player:FindFirstChild(remoteName) or replicatedStorage:FindFirstChild(remoteName)
            if remote and remote:IsA("RemoteEvent") then
                remote:FireServer(best.Object)
                log("Unit equipada via " .. remoteName, "success")
                break
            end
        end
        
        -- Tenta mover para o personagem
        if player.Character then
            best.Object.Parent = player.Character
            log("Unit movida para o personagem", "success")
        end
    end
end

-- ================ BYPASS (MULTI-CAMADAS) ================
local function toggleBypass()
    if bypassActive then
        bypassActive = false
        log("Bypass desativado", "info")
        return
    end
    
    bypassActive = true
    log("Ativando bypass...", "info")
    
    -- Camada 1: Spoof de metatable
    pcall(function()
        local mt = getrawmetatable and getrawmetatable(game) or getmetatable(game)
        if mt then
            local oldNamecall = mt.__namecall
            setreadonly(mt, false)
            
            mt.__namecall = newcclosure(function(self, ...)
                local method = getnamecallmethod()
                if method == "FireServer" then
                    local remoteName = tostring(self):lower()
                    if remoteName:find("anticheat") or remoteName:find("antiexploit") then
                        return  -- Bloqueia
                    end
                end
                return oldNamecall(self, ...)
            end)
            
            setreadonly(mt, true)
            log("Metatable spoof ativado", "success")
        end
    end)
    
    -- Camada 2: Desconectar eventos de anti-cheat
    pcall(function()
        local connections = getconnections and getconnections(game:GetService("ScriptContext").Error) or {}
        for _, conn in ipairs(connections) do
            conn:Disable()
        end
        log("Eventos de erro desconectados", "success")
    end)
    
    -- Camada 3: Congelar funÃ§Ãµes de anti-cheat na memÃ³ria
    pcall(function()
        for _, v in ipairs(getgc(true)) do
            if type(v) == "function" then
                local info = debug.getinfo and debug.getinfo(v) or {}
                if info.name and (info.name:lower():find("anticheat") or info.name:lower():find("antiexploit")) then
                    hookfunction(v, function() end)
                end
            end
        end
        log("FunÃ§Ãµes de anti-cheat congeladas", "success")
    end)
    
    log("Bypass ativado", "success")
end

-- ================ CRIAÃ‡ÃƒO DA GUI ================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "StelkHub"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- BotÃ£o toggle (sempre visÃ­vel)
local toggleBtn = Instance.new("TextButton")
toggleBtn.Parent = screenGui
toggleBtn.BackgroundColor3 = colors.accent
toggleBtn.Size = UDim2.new(0, 35, 0, 35)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.Text = "â‰¡"
toggleBtn.TextColor3 = colors.background
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 22
toggleBtn.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = toggleBtn
end

-- Frame principal (300x300)
local mainFrame = Instance.new("Frame")
mainFrame.Parent = screenGui
mainFrame.BackgroundColor3 = colors.background
mainFrame.BorderSizePixel = 0
mainFrame.Size = UDim2.new(0, CONFIG.GUI_WIDTH, 0, CONFIG.GUI_HEIGHT)
mainFrame.Position = UDim2.new(0.5, -CONFIG.GUI_WIDTH/2, 0.5, -CONFIG.GUI_HEIGHT/2)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Visible = true
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = mainFrame
end

-- Top Bar
local topBar = Instance.new("Frame")
topBar.Parent = mainFrame
topBar.BackgroundColor3 = colors.secondary
topBar.Size = UDim2.new(1, 0, 0, 40)
topBar.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = topBar
end

local title = Instance.new("TextLabel")
title.Parent = topBar
title.BackgroundTransparency = 1
title.Size = UDim2.new(0, 200, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.Text = "STELK HUB"
title.TextColor3 = colors.accent
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left

local closeBtn = Instance.new("TextButton")
closeBtn.Parent = topBar
closeBtn.BackgroundColor3 = colors.danger
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(1, -30, 0.5, -12.5)
closeBtn.Text = "âœ•"
closeBtn.TextColor3 = colors.text
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
closeBtn.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = closeBtn
end
closeBtn.MouseButton1Click:Connect(function()
    if farmActive then stopFarming() end
    screenGui:Destroy()
end)

-- Abas rolÃ¡veis
local tabContainer = Instance.new("Frame")
tabContainer.Parent = mainFrame
tabContainer.BackgroundColor3 = colors.secondary
tabContainer.Size = UDim2.new(1, 0, 0, 35)
tabContainer.Position = UDim2.new(0, 0, 0, 40)
tabContainer.ClipsDescendants = true

local tabScrolling = Instance.new("ScrollingFrame")
tabScrolling.Parent = tabContainer
tabScrolling.BackgroundTransparency = 1
tabScrolling.Size = UDim2.new(1, 0, 1, 0)
tabScrolling.CanvasSize = UDim2.new(3, 0, 0, 0)  -- Largo o suficiente para rolar
tabScrolling.ScrollBarThickness = 0
tabScrolling.BorderSizePixel = 0

local function createTab(name, pos)
    local btn = Instance.new("TextButton")
    btn.Parent = tabScrolling
    btn.BackgroundColor3 = colors.background
    btn.Size = UDim2.new(0, 55, 0, 25)
    btn.Position = UDim2.new(0, pos, 0.5, -12.5)
    btn.Text = name
    btn.TextColor3 = colors.textDim
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 11
    btn.AutoButtonColor = false
    btn.BorderSizePixel = 0
    do
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = btn
    end
    return btn
end

local tab1 = createTab("MUNDO", 5)
local tab2 = createTab("STARS", 65)
local tab3 = createTab("MOBS", 125)
local tab4 = createTab("UNITS", 185)
local tab5 = createTab("FARM", 245)

local pageIndicator = Instance.new("Frame")
pageIndicator.Parent = tabScrolling
pageIndicator.BackgroundColor3 = colors.accent
pageIndicator.Size = UDim2.new(0, 35, 0, 2)
pageIndicator.Position = UDim2.new(0, 15, 1, -4)
pageIndicator.BorderSizePixel = 0

-- ConteÃºdo (ScrollingFrame para cada pÃ¡gina)
local content = Instance.new("ScrollingFrame")
content.Parent = mainFrame
content.BackgroundColor3 = colors.background
content.Size = UDim2.new(1, -10, 1, -85)
content.Position = UDim2.new(0, 5, 0, 80)
content.CanvasSize = UDim2.new(0, 0, 2, 0)
content.ScrollBarThickness = 4
content.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = content
end

-- PÃ¡ginas
local page1 = Instance.new("Frame")
page1.Parent = content
page1.BackgroundTransparency = 1
page1.Size = UDim2.new(1, 0, 0, 300)  -- Altura fixa para scroll
page1.Position = UDim2.new(0, 0, 0, 0)
page1.Visible = true

local page2 = Instance.new("Frame")
page2.Parent = content
page2.BackgroundTransparency = 1
page2.Size = UDim2.new(1, 0, 0, 300)
page2.Position = UDim2.new(0, 0, 0, 0)
page2.Visible = false

local page3 = Instance.new("Frame")
page3.Parent = content
page3.BackgroundTransparency = 1
page3.Size = UDim2.new(1, 0, 0, 400)
page3.Position = UDim2.new(0, 0, 0, 0)
page3.Visible = false

local page4 = Instance.new("Frame")
page4.Parent = content
page4.BackgroundTransparency = 1
page4.Size = UDim2.new(1, 0, 0, 400)
page4.Position = UDim2.new(0, 0, 0, 0)
page4.Visible = false

local page5 = Instance.new("Frame")
page5.Parent = content
page5.BackgroundTransparency = 1
page5.Size = UDim2.new(1, 0, 0, 250)
page5.Position = UDim2.new(0, 0, 0, 0)
page5.Visible = false

-- ================ PÃGINA 1: MUNDO ================
local worldCard = Instance.new("Frame")
worldCard.Parent = page1
worldCard.BackgroundColor3 = colors.secondary
worldCard.Size = UDim2.new(0, 260, 0, 70)
worldCard.Position = UDim2.new(0.5, -130, 0, 10)
worldCard.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = worldCard
end

local worldIcon = Instance.new("TextLabel")
worldIcon.Parent = worldCard
worldIcon.BackgroundTransparency = 1
worldIcon.Size = UDim2.new(0, 30, 1, 0)
worldIcon.Position = UDim2.new(0, 10, 0, 0)
worldIcon.Text = "ðŸŒ"
worldIcon.TextColor3 = colors.accent
worldIcon.Font = Enum.Font.GothamBold
worldIcon.TextSize = 24

local worldNameLabel = Instance.new("TextLabel")
worldNameLabel.Parent = worldCard
worldNameLabel.BackgroundTransparency = 1
worldNameLabel.Size = UDim2.new(0, 180, 0, 25)
worldNameLabel.Position = UDim2.new(0, 50, 0, 10)
worldNameLabel.Text = "Detectando..."
worldNameLabel.TextColor3 = colors.accent
worldNameLabel.Font = Enum.Font.GothamBold
worldNameLabel.TextSize = 14
worldNameLabel.TextXAlignment = Enum.TextXAlignment.Left

local worldStatusLabel = Instance.new("TextLabel")
worldStatusLabel.Parent = worldCard
worldStatusLabel.BackgroundTransparency = 1
worldStatusLabel.Size = UDim2.new(0, 180, 0, 20)
worldStatusLabel.Position = UDim2.new(0, 50, 0, 40)
worldStatusLabel.Text = ""
worldStatusLabel.TextColor3 = colors.textDim
worldStatusLabel.Font = Enum.Font.Gotham
worldStatusLabel.TextSize = 10
worldStatusLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Recursos
local resourcesCard = Instance.new("Frame")
resourcesCard.Parent = page1
resourcesCard.BackgroundColor3 = colors.secondary
resourcesCard.Size = UDim2.new(0, 260, 0, 60)
resourcesCard.Position = UDim2.new(0.5, -130, 0, 90)
resourcesCard.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = resourcesCard
end

local gemsFrame = Instance.new("Frame")
gemsFrame.Parent = resourcesCard
gemsFrame.BackgroundColor3 = colors.tertiary
gemsFrame.Size = UDim2.new(0, 110, 0, 40)
gemsFrame.Position = UDim2.new(0, 15, 0.5, -20)
gemsFrame.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = gemsFrame
end

local gemsIcon = Instance.new("TextLabel")
gemsIcon.Parent = gemsFrame
gemsIcon.BackgroundTransparency = 1
gemsIcon.Size = UDim2.new(0, 25, 1, 0)
gemsIcon.Position = UDim2.new(0, 5, 0, 0)
gemsIcon.Text = "ðŸ’Ž"
gemsIcon.TextColor3 = colors.accent
gemsIcon.Font = Enum.Font.GothamBold
gemsIcon.TextSize = 16

local gemsLabel = Instance.new("TextLabel")
gemsLabel.Parent = gemsFrame
gemsLabel.BackgroundTransparency = 1
gemsLabel.Size = UDim2.new(0, 70, 0, 20)
gemsLabel.Position = UDim2.new(0, 35, 0.5, -10)
gemsLabel.Text = "0"
gemsLabel.TextColor3 = colors.accent
gemsLabel.Font = Enum.Font.GothamBold
gemsLabel.TextSize = 14
gemsLabel.TextXAlignment = Enum.TextXAlignment.Left

local goldFrame = Instance.new("Frame")
goldFrame.Parent = resourcesCard
goldFrame.BackgroundColor3 = colors.tertiary
goldFrame.Size = UDim2.new(0, 110, 0, 40)
goldFrame.Position = UDim2.new(1, -125, 0.5, -20)
goldFrame.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = goldFrame
end

local goldIcon = Instance.new("TextLabel")
goldIcon.Parent = goldFrame
goldIcon.BackgroundTransparency = 1
goldIcon.Size = UDim2.new(0, 25, 1, 0)
goldIcon.Position = UDim2.new(0, 5, 0, 0)
goldIcon.Text = "ðŸª™"
goldIcon.TextColor3 = colors.accent
goldIcon.Font = Enum.Font.GothamBold
goldIcon.TextSize = 16

local goldLabel = Instance.new("TextLabel")
goldLabel.Parent = goldFrame
goldLabel.BackgroundTransparency = 1
goldLabel.Size = UDim2.new(0, 70, 0, 20)
goldLabel.Position = UDim2.new(0, 35, 0.5, -10)
goldLabel.Text = "0"
goldLabel.TextColor3 = colors.accent
goldLabel.Font = Enum.Font.GothamBold
goldLabel.TextSize = 14
goldLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Lista de mundos detectados
local worldsList = Instance.new("TextLabel")
worldsList.Parent = page1
worldsList.BackgroundColor3 = colors.secondary
worldsList.Size = UDim2.new(0, 260, 0, 90)
worldsList.Position = UDim2.new(0.5, -130, 0, 160)
worldsList.Text = "Mundos detectados:\n"
worldsList.TextColor3 = colors.textDim
worldsList.Font = Enum.Font.Gotham
worldsList.TextSize = 10
worldsList.TextWrapped = true
worldsList.TextXAlignment = Enum.TextXAlignment.Left
worldsList.TextYAlignment = Enum.TextYAlignment.Top
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = worldsList
end

-- ================ PÃGINA 2: STARS ================
local starsList = Instance.new("TextLabel")
starsList.Parent = page2
starsList.BackgroundColor3 = colors.secondary
starsList.Size = UDim2.new(0, 260, 0, 150)
starsList.Position = UDim2.new(0.5, -130, 0, 10)
starsList.Text = "Procurando Stars...\n"
starsList.TextColor3 = colors.textDim
starsList.Font = Enum.Font.Gotham
starsList.TextSize = 10
starsList.TextWrapped = true
starsList.TextXAlignment = Enum.TextXAlignment.Left
starsList.TextYAlignment = Enum.TextYAlignment.Top
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = starsList
end

local refreshStarsBtn = Instance.new("TextButton")
refreshStarsBtn.Parent = page2
refreshStarsBtn.BackgroundColor3 = colors.tertiary
refreshStarsBtn.Size = UDim2.new(0, 70, 0, 25)
refreshStarsBtn.Position = UDim2.new(0.5, -105, 0, 170)
refreshStarsBtn.Text = "ðŸ”„"
refreshStarsBtn.TextColor3 = colors.text
refreshStarsBtn.Font = Enum.Font.GothamBold
refreshStarsBtn.TextSize = 12
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = refreshStarsBtn
end

local spinStarBtn = Instance.new("TextButton")
spinStarBtn.Parent = page2
spinStarBtn.BackgroundColor3 = colors.tertiary
spinStarBtn.Size = UDim2.new(0, 70, 0, 25)
spinStarBtn.Position = UDim2.new(0.5, -35, 0, 170)
spinStarBtn.Text = "ðŸŽ¯"
spinStarBtn.TextColor3 = colors.text
spinStarBtn.Font = Enum.Font.GothamBold
spinStarBtn.TextSize = 12
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = spinStarBtn
end

local autoSpinBtn = Instance.new("TextButton")
autoSpinBtn.Parent = page2
autoSpinBtn.BackgroundColor3 = colors.tertiary
autoSpinBtn.Size = UDim2.new(0, 70, 0, 25)
autoSpinBtn.Position = UDim2.new(0.5, 35, 0, 170)
autoSpinBtn.Text = "âš¡"
autoSpinBtn.TextColor3 = colors.text
autoSpinBtn.Font = Enum.Font.GothamBold
autoSpinBtn.TextSize = 12
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = autoSpinBtn
end

-- ================ PÃGINA 3: MOBS ================
local mobsScrolling = Instance.new("ScrollingFrame")
mobsScrolling.Parent = page3
mobsScrolling.BackgroundColor3 = colors.secondary
mobsScrolling.Size = UDim2.new(0, 260, 0, 200)
mobsScrolling.Position = UDim2.new(0.5, -130, 0, 10)
mobsScrolling.CanvasSize = UDim2.new(0, 0, 2, 0)
mobsScrolling.ScrollBarThickness = 4
mobsScrolling.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = mobsScrolling
end

local selectedMobFrame = Instance.new("Frame")
selectedMobFrame.Parent = page3
selectedMobFrame.BackgroundColor3 = colors.tertiary
selectedMobFrame.Size = UDim2.new(0, 260, 0, 30)
selectedMobFrame.Position = UDim2.new(0.5, -130, 0, 220)
selectedMobFrame.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = selectedMobFrame
end

local selectedMobText = Instance.new("TextLabel")
selectedMobText.Parent = selectedMobFrame
selectedMobText.BackgroundTransparency = 1
selectedMobText.Size = UDim2.new(1, -10, 1, 0)
selectedMobText.Position = UDim2.new(0, 10, 0, 0)
selectedMobText.Text = "Nenhum mob selecionado"
selectedMobText.TextColor3 = colors.textDim
selectedMobText.Font = Enum.Font.Gotham
selectedMobText.TextSize = 10
selectedMobText.TextXAlignment = Enum.TextXAlignment.Left

local refreshMobsBtn = Instance.new("TextButton")
refreshMobsBtn.Parent = page3
refreshMobsBtn.BackgroundColor3 = colors.tertiary
refreshMobsBtn.Size = UDim2.new(0, 120, 0, 25)
refreshMobsBtn.Position = UDim2.new(0.5, -60, 0, 260)
refreshMobsBtn.Text = "ATUALIZAR"
refreshMobsBtn.TextColor3 = colors.text
refreshMobsBtn.Font = Enum.Font.GothamBold
refreshMobsBtn.TextSize = 10
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = refreshMobsBtn
end

-- ================ PÃGINA 4: UNITS ================
local unitsScrolling = Instance.new("ScrollingFrame")
unitsScrolling.Parent = page4
unitsScrolling.BackgroundColor3 = colors.secondary
unitsScrolling.Size = UDim2.new(0, 260, 0, 200)
unitsScrolling.Position = UDim2.new(0.5, -130, 0, 10)
unitsScrolling.CanvasSize = UDim2.new(0, 0, 2, 0)
unitsScrolling.ScrollBarThickness = 4
unitsScrolling.BorderSizePixel = 0
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = unitsScrolling
end

local equipBestBtn = Instance.new("TextButton")
equipBestBtn.Parent = page4
equipBestBtn.BackgroundColor3 = colors.success
equipBestBtn.Size = UDim2.new(0, 120, 0, 25)
equipBestBtn.Position = UDim2.new(0.5, -60, 0, 220)
equipBestBtn.Text = "EQUIP BEST"
equipBestBtn.TextColor3 = colors.background
equipBestBtn.Font = Enum.Font.GothamBold
equipBestBtn.TextSize = 10
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = equipBestBtn
end

local refreshUnitsBtn = Instance.new("TextButton")
refreshUnitsBtn.Parent = page4
refreshUnitsBtn.BackgroundColor3 = colors.tertiary
refreshUnitsBtn.Size = UDim2.new(0, 120, 0, 25)
refreshUnitsBtn.Position = UDim2.new(0.5, -60, 0, 255)
refreshUnitsBtn.Text = "ATUALIZAR"
refreshUnitsBtn.TextColor3 = colors.text
refreshUnitsBtn.Font = Enum.Font.GothamBold
refreshUnitsBtn.TextSize = 10
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = refreshUnitsBtn
end

-- ================ PÃGINA 5: FARM ================
local farmInfo = Instance.new("TextLabel")
farmInfo.Parent = page5
farmInfo.BackgroundTransparency = 1
farmInfo.Size = UDim2.new(1, -20, 0, 20)
farmInfo.Position = UDim2.new(0, 10, 0, 10)
farmInfo.Text = "Mob selecionado: Nenhum"
farmInfo.TextColor3 = colors.textDim
farmInfo.Font = Enum.Font.Gotham
farmInfo.TextSize = 11
farmInfo.TextXAlignment = Enum.TextXAlignment.Left

local farmStatus = Instance.new("TextLabel")
farmStatus.Parent = page5
farmStatus.BackgroundTransparency = 1
farmStatus.Size = UDim2.new(1, -20, 0, 20)
farmStatus.Position = UDim2.new(0, 10, 0, 35)
farmStatus.Text = "Status: Parado"
farmStatus.TextColor3 = colors.textDim
farmStatus.Font = Enum.Font.Gotham
farmStatus.TextSize = 11
farmStatus.TextXAlignment = Enum.TextXAlignment.Left

local farmBtn = Instance.new("TextButton")
farmBtn.Parent = page5
farmBtn.BackgroundColor3 = colors.tertiary
farmBtn.Size = UDim2.new(0, 120, 0, 30)
farmBtn.Position = UDim2.new(0.5, -60, 0, 70)
farmBtn.Text = "â–¶ï¸ INICIAR"
farmBtn.TextColor3 = colors.text
farmBtn.Font = Enum.Font.GothamBold
farmBtn.TextSize = 12
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = farmBtn
end

local bypassBtn = Instance.new("TextButton")
bypassBtn.Parent = page5
bypassBtn.BackgroundColor3 = colors.tertiary
bypassBtn.Size = UDim2.new(0, 120, 0, 30)
bypassBtn.Position = UDim2.new(0.5, -60, 0, 110)
bypassBtn.Text = "ðŸ›¡ï¸ BYPASS"
bypassBtn.TextColor3 = colors.text
bypassBtn.Font = Enum.Font.GothamBold
bypassBtn.TextSize = 12
do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = bypassBtn
end

-- ================ FUNÃ‡Ã•ES DE NAVEGAÃ‡ÃƒO ================
local function switchPage(page)
    page1.Visible = (page == 1)
    page2.Visible = (page == 2)
    page3.Visible = (page == 3)
    page4.Visible = (page == 4)
    page5.Visible = (page == 5)
    
    local positions = {15, 75, 135, 195, 255}
    tweenService:Create(pageIndicator, TweenInfo.new(0.2), {
        Position = UDim2.new(0, positions[page], 1, -4)
    }):Play()
    
    local tabs = {tab1, tab2, tab3, tab4, tab5}
    for i = 1, 5 do
        tabs[i].TextColor3 = (i == page) and colors.accent or colors.textDim
    end
    
    -- Ajusta canvas size do content conforme a pÃ¡gina
    local pageHeight = 300
    if page == 2 then pageHeight = 250
    elseif page == 3 then pageHeight = 320
    elseif page == 4 then pageHeight = 320
    elseif page == 5 then pageHeight = 200
    end
    content.CanvasSize = UDim2.new(0, 0, 0, pageHeight)
end

tab1.MouseButton1Click:Connect(function() switchPage(1) end)
tab2.MouseButton1Click:Connect(function() switchPage(2) end)
tab3.MouseButton1Click:Connect(function() switchPage(3) end)
tab4.MouseButton1Click:Connect(function() switchPage(4) end)
tab5.MouseButton1Click:Connect(function() switchPage(5) end)

toggleBtn.MouseButton1Click:Connect(function()
    hubVisible = not hubVisible
    mainFrame.Visible = hubVisible
end)

-- ================ ATUALIZAÃ‡Ã•ES DAS PÃGINAS ================
local function updateWorldPage()
    detectCurrentWorld()
    worldNameLabel.Text = currentWorld
    worldNameLabel.TextColor3 = currentWorldColor
    worldStatusLabel.Text = inLeafWorld and "âœ… No Leaf World" or "âŒ Fora"
    
    gems, gold = getGemsAndGold()
    gemsLabel.Text = tostring(gems)
    goldLabel.Text = tostring(gold)
    
    -- Atualiza lista de mundos detectados
    local worldsText = "Mundos detectados:\n"
    for i, world in ipairs(worldsDetected) do
        worldsText = worldsText .. "â€¢ " .. world.name .. "\n"
    end
    worldsList.Text = worldsText
end

local function updateStarsPage()
    stars = findStars()
    local txt = "STARS: " .. #stars .. "\n"
    for i, s in ipairs(stars) do
        local dist = "?"
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            dist = math.floor((player.Character.HumanoidRootPart.Position - s.Position).Magnitude) .. "m"
        end
        txt = txt .. i .. ". " .. s.Name .. " [" .. dist .. "]\n"
    end
    starsList.Text = txt
    if #stars > 0 then
        selectedStar = stars[1]
        spinStarBtn.Text = "ðŸŽ¯ " .. stars[1].Name
    else
        spinStarBtn.Text = "ðŸŽ¯"
    end
end

local function updateMobsPage()
    -- Limpa botÃµes antigos
    for _, child in ipairs(mobsScrolling:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    mobs = findMobs()
    
    for i, mob in ipairs(mobs) do
        local btn = Instance.new("TextButton")
        btn.Parent = mobsScrolling
        btn.BackgroundColor3 = colors.tertiary
        btn.Size = UDim2.new(1, -10, 0, 25)
        btn.Position = UDim2.new(0, 5, 0, 5 + (i-1) * 27)
        btn.Text = ""
        btn.AutoButtonColor = false
        btn.BorderSizePixel = 0
        do
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 4)
            corner.Parent = btn
        end
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Parent = btn
        nameLabel.BackgroundTransparency = 1
        nameLabel.Size = UDim2.new(0, 120, 1, 0)
        nameLabel.Position = UDim2.new(0, 5, 0, 0)
        nameLabel.Text = mob.Name
        nameLabel.TextColor3 = mob.IsBoss and colors.warning or colors.text
        nameLabel.Font = Enum.Font.Gotham
        nameLabel.TextSize = 9
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        
        local healthLabel = Instance.new("TextLabel")
        healthLabel.Parent = btn
        healthLabel.BackgroundTransparency = 1
        healthLabel.Size = UDim2.new(0, 50, 1, 0)
        healthLabel.Position = UDim2.new(0, 130, 0, 0)
        healthLabel.Text = math.floor(mob.Health) .. "HP"
        healthLabel.TextColor3 = mob.IsBoss and colors.warning or colors.success
        healthLabel.Font = Enum.Font.Gotham
        healthLabel.TextSize = 9
        
        if mob.IsBoss then
            local bossLabel = Instance.new("TextLabel")
            bossLabel.Parent = btn
            bossLabel.BackgroundTransparency = 1
            bossLabel.Size = UDim2.new(0, 35, 1, 0)
            bossLabel.Position = UDim2.new(0, 185, 0, 0)
            bossLabel.Text = "BOSS"
            bossLabel.TextColor3 = colors.warning
            bossLabel.Font = Enum.Font.GothamBold
            bossLabel.TextSize = 8
        end
        
        btn.MouseButton1Click:Connect(function()
            selectedMob = mob
            selectedMobText.Text = "âœ… " .. mob.Name
            farmInfo.Text = "Mob selecionado: " .. mob.Name
        end)
    end
    
    mobsScrolling.CanvasSize = UDim2.new(0, 0, 0, #mobs * 27 + 10)
end

local function updateUnitsPage()
    -- Limpa botÃµes antigos
    for _, child in ipairs(unitsScrolling:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    units = findUnits()
    
    if #units == 0 then
        local lbl = Instance.new("TextLabel")
        lbl.Parent = unitsScrolling
        lbl.BackgroundTransparency = 1
        lbl.Size = UDim2.new(1, 0, 0, 30)
        lbl.Position = UDim2.new(0, 0, 0, 10)
        lbl.Text = "Nenhuma unit encontrada"
        lbl.TextColor3 = colors.textDim
        lbl.Font = Enum.Font.Gotham
        lbl.TextSize = 11
        return
    end
    
    for i, unit in ipairs(units) do
        local btn = Instance.new("TextButton")
        btn.Parent = unitsScrolling
        btn.BackgroundColor3 = colors.tertiary
        btn.Size = UDim2.new(1, -10, 0, 25)
        btn.Position = UDim2.new(0, 5, 0, 5 + (i-1) * 27)
        btn.Text = ""
        btn.AutoButtonColor = false
        btn.BorderSizePixel = 0
        do
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 4)
            corner.Parent = btn
        end
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Parent = btn
        nameLabel.BackgroundTransparency = 1
        nameLabel.Size = UDim2.new(0, 150, 1, 0)
        nameLabel.Position = UDim2.new(0, 5, 0, 0)
        nameLabel.Text = unit.Name
        nameLabel.TextColor3 = colors.text
        nameLabel.Font = Enum.Font.Gotham
        nameLabel.TextSize = 9
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        
        local damageLabel = Instance.new("TextLabel")
        damageLabel.Parent = btn
        damageLabel.BackgroundTransparency = 1
        damageLabel.Size = UDim2.new(0, 50, 1, 0)
        damageLabel.Position = UDim2.new(0, 160, 0, 0)
        damageLabel.Text = "D:" .. unit.Damage
        damageLabel.TextColor3 = colors.success
        damageLabel.Font = Enum.Font.Gotham
        damageLabel.TextSize = 9
    end
    
    unitsScrolling.CanvasSize = UDim2.new(0, 0, 0, #units * 27 + 10)
end

-- ================ CONEXÃ•ES DOS BOTÃ•ES ================
refreshStarsBtn.MouseButton1Click:Connect(updateStarsPage)
spinStarBtn.MouseButton1Click:Connect(function()
    if selectedStar then
        spinStar(selectedStar)
        updateStarsPage()
    else
        log("Nenhuma star selecionada", "warning")
    end
end)

autoSpinBtn.MouseButton1Click:Connect(function()
    local spinning = false
    if autoSpinBtn.Text == "âš¡" then
        autoSpinBtn.Text = "â¹ï¸"
        autoSpinBtn.BackgroundColor3 = colors.danger
        spinning = true
        task.spawn(function()
            while spinning do
                stars = findStars()
                for _, star in ipairs(stars) do
                    spinStar(star)
                    task.wait(0.5)
                end
                task.wait(1)
            end
        end)
    else
        autoSpinBtn.Text = "âš¡"
        autoSpinBtn.BackgroundColor3 = colors.tertiary
        spinning = false
    end
end)

refreshMobsBtn.MouseButton1Click:Connect(updateMobsPage)
refreshUnitsBtn.MouseButton1Click:Connect(updateUnitsPage)
equipBestBtn.MouseButton1Click:Connect(equipBestUnit)

farmBtn.MouseButton1Click:Connect(function()
    if farmActive then
        stopFarming()
        farmBtn.Text = "â–¶ï¸ INICIAR"
        farmBtn.BackgroundColor3 = colors.tertiary
        farmStatus.Text = "Status: Parado"
        farmStatus.TextColor3 = colors.textDim
    else
        if not selectedMob then
            farmInfo.Text = "ERRO: Selecione um mob!"
            return
        end
        startFarming()
        farmBtn.Text = "â¹ï¸ PARAR"
        farmBtn.BackgroundColor3 = colors.danger
        farmStatus.Text = "Status: Ativo"
        farmStatus.TextColor3 = colors.success
    end
end)

bypassBtn.MouseButton1Click:Connect(function()
    toggleBypass()
    bypassBtn.Text = bypassActive and "âœ… BYPASS ON" or "ðŸ›¡ï¸ BYPASS"
    bypassBtn.BackgroundColor3 = bypassActive and colors.success or colors.tertiary
end)

-- ================ ATUALIZAÃ‡Ã•ES AUTOMÃTICAS ================
task.spawn(function()
    while true do
        updateWorldPage()
        task.wait(3)
    end
end)

task.spawn(function()
    while true do
        if page2.Visible then updateStarsPage() end
        if page3.Visible then updateMobsPage() end
        if page4.Visible then updateUnitsPage() end
        task.wait(3)
    end
end)

-- ================ INICIALIZAÃ‡ÃƒO ================
updateWorldPage()
updateStarsPage()
updateMobsPage()
updateUnitsPage()
switchPage(1)

log("Stelk Hub v15.0 Ultimate carregado com sucesso!", "success")
log("Todas as funcionalidades ativas. Use o botÃ£o â‰¡ para esconder/mostrar.", "info")
